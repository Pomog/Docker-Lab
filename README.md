# 1. Prerequisites
## 1.1. Install Docker:
```bash
docker --version
```
## 1.2. Install Docker Compose:
```bash
docker-compose --version
```
## 1.3. Install Node.js:
```bash
node --version
```
# 2. Core Docker Concepts
- Images: A Docker image is a read-only template with instructions for creating a Docker container. Think of it like a “blueprint” of your application.

- Containers: A container is a running instance of an image. Containers are lightweight and isolated but can communicate with each other through networks.

- Dockerfile: A text file containing instructions to build a Docker image. You use docker build to create an image from a Dockerfile.

- Docker Compose: A tool that defines and runs multi-container Docker applications using a docker-compose.yml file. Instead of manually running multiple docker run commands, you can bring up an entire stack with a single docker-compose up.

- Volumes: Persist data generated by a Docker container. For example, storing MongoDB’s data in a volume means you won’t lose your data if the MongoDB container restarts.

- Networks: Docker containers can communicate with each other using virtual networks. Docker Compose automatically creates a network so your containers can talk to each other by name.

# 3. Project Structure
- A simple server.js to serve a basic index.html.
- A route to serve a profile image.
- A small form that updates user info in MongoDB.
- A Dockerfile for our Node app.
- A docker-compose.yml that defines:
    - Node.js container
    - MongoDB container
    - Mongo Express container (web-based UI to view MongoDB data)

# 4. Building the Node.js Application
## 4.1. Initialize a Node.js project
- Create a new folder and initialize Node:
```bash
mkdir my-docker-app
cd my-docker-app
npm init -y
```
This generates a package.json with default values.
## 4.2 Install dependencies:
- For simplicity, let’s install the official MongoDB Node driver
```bash
npm install mongodb
npm install express
```
## 4.3 Create server.js:
## 4.4 Create index.html:
## 4.5 Add a sample image:
- profile-1.jpg

# 5. Dockerizing the Node.js Application
## 5.1 Create a Dockerfile:
- In your my-docker-app/ folder, create a file named Dockerfile:
    - FROM node:14: We base our image on Node.js v14.
    - WORKDIR /app: Sets /app as the working directory inside the container.
    - COPY package*.json ./: Copies package.json and package-lock.json.
    - RUN npm install: Installs Node dependencies inside the container.
    - COPY . .: Copies the rest of the local files into the container’s /app directory.
    - EXPOSE 3000: Documents that the container listens on port 3000.
    - CMD ["node", "server.js"]: The default command that starts our Node server.
## 5.2 Build and Run the Docker Image (Manually):
- Build the Docker image:
```bash
docker build -t my-docker-app .
```
- complete rebuild by ignoring all cached layers
```bash
 docker build --no-cache -t my-docker-app .
```
- Run the container:
```bash
docker run -p 3000:3000 my-docker-app
```
- Confirm Node Modules in Container:
    - -i (interactive): Keeps the container's standard input (STDIN) open.
    - -t (TTY): Allocates a pseudo-terminal, which makes the session interactive.
```bash
docker run -it my-docker-app /bin/bash
ls -l node_modules
```
- Open a Shell in the Container:
```bash
docker exec -it node-app /bin/sh
```
- To stop all running Docker containers (-q: Stands for "quiet"):
```bash
docker stop $(docker ps -q)
```
- To remove all containers after stopping them:
```bash
docker rm $(docker ps -aq)
```
- Docker provides several "prune" commands that help clean up unused Docker objects and free up disk space. Some common prune commands include:
    - Removes all stopped containers.
```bash
docker container prune
```
    - Removes dangling images (images that are not tagged and are not referenced by any container). You can use the -a flag with this command (docker image prune -a) to remove all unused images, not just dangling ones.
```bash
docker image prune
```
    - Cleans up unused data in general. By default, this removes stopped containers, dangling images, and unused networks. Adding the -a flag (docker system prune -a) will also remove all unused images
```bash
docker system prune
```


- -p 3000:3000 maps the container’s port 3000 to your machine’s port 3000.
- You can open http://localhost:3000 to see your Node app.
- At this point, the app is running in a container, but we haven’t connected to MongoDB yet.

# 6. Docker Compose for Node, MongoDB, and Mongo Express
## 6.1. Create docker-compose.yml
### 6.1.1. services.web:
- build: . tells Docker Compose to build the Node.js image using the Dockerfile in the current directory.
- ports: 3000:3000 means we map our local port 3000 to the container’s port 3000.
- environment: We pass environment variables to the container. Notice MONGO_HOST=mongo, because we’ll call the MongoDB container mongo.
- depends_on: ensures the mongo service starts before our web service.

### 6.1.2. services.mongo:
- Uses the official MongoDB image mongo:4.4.
- ports: 27017:27017 so we can access MongoDB from our host (optional, but useful for local dev).
- volumes: We mount a named volume mongo-data to /data/db inside the container for persistent storage.


### 6.1.3. services.mongo-express:
- Uses the mongo-express image.
- depends_on: starts after MongoDB is up.
- ports: 8081:8081 so you can access Mongo Express at http://localhost:8081.
- environment: Tells Mongo Express how to connect to the mongo service.
### 6.1.4. 
- volumes: We define a named volume mongo-data for Mongo’s data directory.

## 6.2 Spin Up the Containers
```bash
docker-compose up --build
```
- --build forces a rebuild of the Node.js image if needed.
- Docker Compose will:
    - Build your Node.js image.
    - Start the Node.js container (web).
    - Start the MongoDB container (mongo).
    - Start the Mongo Express container (mongo-express).
## 6.3 Verify Everything is Working
- Node.js App: Open http://localhost:3000. You should see the user profile page with the image, name, email, and interests.
- Mongo Express: Open http://localhost:8081. You’ll see the Mongo Express UI. You should see a database named my-db (if you’ve inserted data already).
- Check the user:
    - If you click “Edit Profile” and “Save Profile,” it will upsert the user data into the my-db.users collection in MongoDB.
    - In Mongo Express, refresh the my-db database and look at the users collection. You’ll see the user record with name, email, and interests.
## 7. Common Docker Commands
- docker ps: List running containers.
- docker images: List all Docker images on your system.
- docker logs <container-name>: View logs from a specific container.
- docker logs my-container > container_logs.txt: save a container's logs to a file
- docker exec -it <container-name> /bin/bash: Open a shell inside a running container (if it has bash/sh).
- docker-compose up -d: Run containers in the background (detached).
- docker-compose down: Stop and remove containers, networks, etc. created by docker-compose up.
